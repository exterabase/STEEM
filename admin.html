<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STEEM — Адмін панель</title>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f0f4f8;--white:#fff;--dark:#0f172a;--text:#1e293b;
  --muted:#64748b;--border:#e2e8f0;--sky:#0ea5e9;--sky-d:#0284c7;
  --sky-bg:#f0f9ff;--red:#ef4444;--red-bg:#fef2f2;--green:#16a34a;
  --green-bg:#f0fdf4;--yellow:#f59e0b;--yellow-bg:#fffbeb;
  --shadow:0 4px 20px rgba(0,0,0,0.07);--r:12px;
}
body{font-family:'Manrope',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
button{font-family:inherit;cursor:pointer}
input,select,textarea{font-family:inherit}

/* LOGIN */
.login-wrap{
  min-height:100vh;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(135deg,var(--dark) 0%,#1e3a5f 100%);
  padding:20px;
}
.login-box{
  background:#fff;border-radius:18px;padding:40px;width:100%;max-width:380px;
  text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.3);
}
.login-icon{font-size:0;margin-bottom:20px;color:var(--sky);display:flex;align-items:center;justify-content:center}
.login-box h1{font-size:22px;font-weight:800;margin-bottom:6px}
.login-box p{color:var(--muted);font-size:13px;margin-bottom:28px}
.linput{
  width:100%;border:1.5px solid var(--border);border-radius:9px;
  padding:13px 15px;font-size:14px;outline:none;transition:.2s;
  margin-bottom:14px;text-align:center;letter-spacing:2px;
}
.linput:focus{border-color:var(--sky);box-shadow:0 0 0 3px rgba(14,165,233,0.1)}
.lbtn{
  width:100%;background:var(--sky);color:#fff;border:none;border-radius:9px;
  padding:14px;font-size:15px;font-weight:700;cursor:pointer;transition:.2s;
}
.lbtn:hover{background:var(--sky-d)}
.lerr{color:var(--red);font-size:12px;margin-top:8px;display:none}

/* ADMIN LAYOUT */
.admin-wrap{display:none}
.aside{
  width:230px;background:var(--dark);color:#fff;min-height:100vh;
  position:fixed;left:0;top:0;z-index:50;
  display:flex;flex-direction:column;
}
.aside-logo{padding:20px 20px 16px;border-bottom:1px solid rgba(255,255,255,0.08)}
.aside-logo h2{font-size:17px;font-weight:800}
.aside-logo span{color:var(--sky)}
.aside-logo small{display:block;font-size:11px;color:rgba(255,255,255,0.4);margin-top:2px}
.aside-nav{padding:12px 10px;flex:1}
.nav-item{
  display:flex;align-items:center;gap:10px;padding:11px 12px;
  border-radius:9px;cursor:pointer;transition:.2s;font-size:13px;
  font-weight:600;color:rgba(255,255,255,0.6);margin-bottom:3px;border:none;
  background:transparent;width:100%;text-align:left;
}
.nav-item:hover{background:rgba(255,255,255,0.07);color:#fff}
.nav-item.active{background:var(--sky);color:#fff}
.nav-icon{width:20px;display:flex;align-items:center;justify-content:center;color:inherit;flex-shrink:0}
.aside-bottom{padding:12px 10px;border-top:1px solid rgba(255,255,255,0.08)}
.out-btn{
  width:100%;padding:10px;background:rgba(239,68,68,0.15);color:#fca5a5;
  border:1px solid rgba(239,68,68,0.2);border-radius:8px;font-size:12px;
  font-weight:700;cursor:pointer;transition:.2s;
}
.out-btn:hover{background:rgba(239,68,68,0.25)}

.main-content{margin-left:230px;padding:28px;min-height:100vh}
.page{display:none}
.page.active{display:block}

/* TOP BAR */
.topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:12px}
.topbar h1{font-size:22px;font-weight:800;color:var(--dark)}
.topbar .tsub{font-size:13px;color:var(--muted);margin-top:2px}

/* STAT CARDS */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:16px;margin-bottom:28px}
.stat{background:var(--white);border-radius:var(--r);padding:20px;box-shadow:var(--shadow);border:1px solid var(--border)}
.stat-icon{margin-bottom:10px;color:var(--sky)}
.stat-val{font-size:26px;font-weight:800;color:var(--dark)}
.stat-label{font-size:12px;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.4px}

/* CARD */
.card{background:var(--white);border-radius:var(--r);box-shadow:var(--shadow);border:1px solid var(--border);overflow:hidden;margin-bottom:20px}
.card-head{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.card-head h3{font-size:15px;font-weight:800;color:var(--dark)}
.card-body{padding:20px}

/* FILTERS */
.filters{display:flex;gap:10px;flex-wrap:wrap}
.fin{
  border:1.5px solid var(--border);border-radius:8px;padding:8px 12px;
  font-size:13px;outline:none;background:#fff;color:var(--text);transition:.2s;
}
.fin:focus{border-color:var(--sky)}
.fbtn{
  background:var(--sky);color:#fff;border:none;border-radius:8px;
  padding:8px 16px;font-size:13px;font-weight:700;cursor:pointer;transition:.2s;
}
.fbtn:hover{background:var(--sky-d)}
.fbtn.outline{background:transparent;border:1.5px solid var(--border);color:var(--text)}
.fbtn.outline:hover{border-color:var(--sky);color:var(--sky-d)}

/* TABLE */
.tbl-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
th{padding:10px 14px;text-align:left;font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.4px;border-bottom:1px solid var(--border);white-space:nowrap}
td{padding:12px 14px;border-bottom:1px solid var(--border);vertical-align:middle}
tr:last-child td{border-bottom:none}
tr:hover td{background:#fafbfc}
.td-name{font-weight:700;color:var(--dark)}
.td-phone{color:var(--sky-d);font-size:12px}

/* BADGES */
.badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700}
.b-conf{background:var(--green-bg);color:var(--green)}
.b-cancel{background:var(--red-bg);color:var(--red)}
.b-pend{background:var(--yellow-bg);color:var(--yellow)}

/* ACTION BTNS */
.act-btns{display:flex;gap:8px;flex-wrap:wrap}
.abtn{
  padding:6px 12px;
  border-radius:999px;
  font-size:11px;
  font-weight:700;
  cursor:pointer;
  border:1px solid var(--border);
  background:#fff;
  color:var(--muted);
  transition:.18s;
  font-family:inherit;
  text-transform:uppercase;
  letter-spacing:.04em;
}
.abtn:focus-visible{
  outline:2px solid var(--sky);
  outline-offset:1px;
}
.abtn-red{
  background:var(--red-bg);
  color:var(--red);
  border-color:rgba(239,68,68,0.4);
}
.abtn-red:hover{
  background:var(--red);
  color:#fff;
}
.abtn-green{
  background:var(--green-bg);
  color:var(--green);
  border-color:rgba(22,163,74,0.4);
}
.abtn-green:hover{
  background:var(--green);
  color:#fff;
}
.abtn-sky{
  background:var(--sky-bg);
  color:var(--sky-d);
  border-color:rgba(14,165,233,0.4);
}
.abtn-sky:hover{
  background:var(--sky);
  color:#fff;
}
.abtn-gray{
  background:var(--bg);
  color:var(--muted);
}
.abtn-gray:hover{
  background:var(--border);
}

.empty-row td{text-align:center;color:var(--muted);padding:32px;font-size:14px}

/* BLOCK CALENDAR */
.bcal-wrap{display:grid;grid-template-columns:auto 1fr;gap:24px;align-items:start}
@media(max-width:700px){.bcal-wrap{grid-template-columns:1fr}}
.mini-cal{background:var(--white);border-radius:var(--r);padding:20px;border:1px solid var(--border);box-shadow:var(--shadow)}
.mc-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.mc-month{font-size:14px;font-weight:700}
.mc-arr{background:var(--bg);border:1px solid var(--border);border-radius:6px;width:28px;height:28px;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;transition:.18s}
.mc-arr:hover{background:var(--sky);color:#fff;border-color:var(--sky)}
.mc-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px}
.mcd-l{text-align:center;font-size:10px;font-weight:700;color:var(--gray);padding:2px 0 5px}
.mcd{
  aspect-ratio:1;border-radius:6px;display:flex;align-items:center;
  justify-content:center;font-size:12px;cursor:pointer;transition:.18s;font-weight:500;
}
.mcd:hover:not(.mcd-p):not(.mcd-e){background:#e0f2fe;color:var(--sky-d)}
.mcd.mcd-t{border:2px solid var(--sky);color:var(--sky-d);font-weight:700}
.mcd.mcd-s{background:var(--sky);color:#fff;font-weight:700}
.mcd.mcd-p{color:var(--border);cursor:default}
.mcd.mcd-e{cursor:default}
.mcd.has-block{position:relative}
.mcd.has-block::after{content:'';position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:var(--red)}

.block-slots{background:var(--white);border-radius:var(--r);padding:20px;border:1px solid var(--border);box-shadow:var(--shadow)}
.block-slots h4{font-size:14px;font-weight:700;margin-bottom:14px;color:var(--dark)}
.slot-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:7px}
.sl-btn{
  padding:8px 4px;border:1.5px solid var(--border);border-radius:7px;
  text-align:center;font-size:11px;font-weight:700;cursor:pointer;
  transition:.18s;background:#fff;color:var(--text);
}
.sl-btn:hover{border-color:var(--sky);color:var(--sky-d)}
.sl-btn.sl-blocked{background:var(--red-bg);border-color:var(--red);color:var(--red)}
.sl-btn.sl-booked{background:var(--bg);color:var(--border);cursor:not-allowed}
.sl-btn.sl-cleaning{background:var(--yellow-bg);color:var(--yellow);cursor:not-allowed;font-size:10px}

/* SETTINGS */
.settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
.scard{background:var(--white);border-radius:var(--r);padding:24px;border:1px solid var(--border);box-shadow:var(--shadow)}
.scard h3{font-size:15px;font-weight:800;margin-bottom:16px;color:var(--dark)}
.sfg{margin-bottom:14px}
.sfg label{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.4px;display:block;margin-bottom:5px}
.sfg input,.sfg textarea,.sfg select{
  width:100%;border:1.5px solid var(--border);border-radius:8px;
  padding:10px 12px;font-size:13px;font-family:inherit;outline:none;transition:.2s;
}
.sfg input:focus,.sfg textarea:focus,.sfg select:focus{border-color:var(--sky)}
.sfg textarea{resize:vertical;min-height:70px}
.save-btn{
  background:var(--sky);color:#fff;border:none;border-radius:8px;
  padding:11px 20px;font-size:13px;font-weight:700;cursor:pointer;
  transition:.2s;width:100%;margin-top:4px;
}
.save-btn:hover{background:var(--sky-d)}

/* MODAL */
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:200;
  display:flex;align-items:center;justify-content:center;padding:16px;
  opacity:0;pointer-events:none;transition:.25s;backdrop-filter:blur(4px);
}
.overlay.open{opacity:1;pointer-events:all}
.mbox{
  background:#fff;border-radius:16px;padding:28px;width:100%;max-width:440px;
  position:relative;transform:scale(.95);transition:.25s;max-height:90vh;overflow-y:auto;
}
.overlay.open .mbox{transform:scale(1)}
.mc{position:absolute;top:12px;right:12px;background:var(--bg);border:1px solid var(--border);border-radius:6px;width:28px;height:28px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:.18s}
.mc:hover{background:var(--red);color:#fff;border-color:var(--red)}
.mtitle{font-size:19px;font-weight:800;margin-bottom:18px;color:var(--dark)}

/* TOAST */
.toast{
  position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);
  background:var(--dark);color:#fff;padding:11px 20px;border-radius:9px;
  font-size:13px;font-weight:600;z-index:999;opacity:0;transition:.3s;max-width:90vw;text-align:center;
}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
.toast.success{background:var(--green)}
.toast.error{background:var(--red)}

/* MOBILE */
.mobile-menu-btn{display:none;position:fixed;top:14px;left:14px;z-index:200;background:var(--dark);color:#fff;border:none;border-radius:8px;width:36px;height:36px;font-size:18px;align-items:center;justify-content:center;cursor:pointer}
@media(max-width:768px){
  .aside{transform:translateX(-100%);transition:.3s}
  .aside.mob-open{transform:none}
  .main-content{margin-left:0;padding:16px;padding-top:56px}
  .mobile-menu-btn{display:flex}
  .stats{grid-template-columns:1fr 1fr}
  .bcal-wrap{grid-template-columns:1fr}
}
@media(max-width:520px){
  .topbar{flex-direction:column;align-items:flex-start}
  .card-body{padding:14px}
  th,td{padding:9px 8px}
  table{font-size:12px}
}
@media(max-width:420px){
  .stats{grid-template-columns:1fr}
  .card-head{padding:12px 14px}
  .main-content{padding:14px;padding-top:56px}
  .filters{flex-direction:column;align-items:stretch}
  .filters .fbtn{width:100%}
  .add-row{grid-template-columns:1fr}
}

/* hr */
hr{border:none;border-top:1px solid var(--border);margin:16px 0}

/* ADD BOOKING FORM */
.add-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:500px){.add-row{grid-template-columns:1fr}}

/* SAUNA PRICE ITEMS */
.price-item{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.price-item label{font-size:13px;font-weight:600;min-width:120px;color:var(--text)}
.price-input{border:1.5px solid var(--border);border-radius:7px;padding:8px 10px;font-size:13px;outline:none;width:100px;transition:.2s;font-family:inherit}
.price-input:focus{border-color:var(--sky)}
</style>
</head>
<body>
<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
  <symbol id="ai-lock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></symbol>
  <symbol id="ai-menu" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></symbol>
  <symbol id="ai-flame" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0011 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 11-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 002.5 3z"/></symbol>
  <symbol id="ai-chart" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></symbol>
  <symbol id="ai-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></symbol>
  <symbol id="ai-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></symbol>
  <symbol id="ai-ban" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></symbol>
  <symbol id="ai-gear" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></symbol>
  <symbol id="ai-logout" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></symbol>
  <symbol id="ai-refresh" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></symbol>
  <symbol id="ai-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></symbol>
  <symbol id="ai-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></symbol>
  <symbol id="ai-warn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></symbol>
  <symbol id="ai-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></symbol>
  <symbol id="ai-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></symbol>
  <symbol id="ai-money" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></symbol>
  <symbol id="ai-trash" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a1 1 0 011-1h4a1 1 0 011 1v2"/></symbol>
  <symbol id="ai-chevl" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></symbol>
  <symbol id="ai-chevr" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></symbol>
  <symbol id="ai-broom" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 21L17 11M18 3l-7 8"/><path d="M13 19l4 2-2-4 5-5-7-1 1 7-1-1z"/></symbol>
  <symbol id="ai-arrow-l" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></symbol>
  <symbol id="ai-pin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></symbol>
  <symbol id="ai-time" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></symbol>
  <symbol id="ai-phone" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 9.81a19.79 19.79 0 01-3.07-8.67A2 2 0 012 0h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 14v2.92z"/></symbol>
</svg>


<!-- LOGIN -->
<div class="login-wrap" id="loginWrap">
  <div class="login-box">
    <div class="login-icon"><svg width="52" height="52" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-lock"/></svg></div>
    <h1>Адмін Панель</h1>
    <p>STEEM — Управління бронюваннями</p>
    <input type="password" class="linput" id="pwInput" placeholder="Введіть пароль" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="lbtn" onclick="doLogin()">Увійти</button>
    <div class="lerr" id="lerr">Невірний пароль. Спробуйте ще раз.</div>
    <div style="margin-top:16px"><a href="index.html" style="font-size:12px;color:var(--muted)"><svg width="12" height="12" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-arrow-l"/></svg> Повернутись на сайт</a></div>
  </div>
</div>

<!-- MOBILE MENU BTN -->
<button class="mobile-menu-btn" id="mobMenuBtn" onclick="toggleMobMenu()"><svg width="20" height="20" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-menu"/></svg></button>

<!-- ADMIN -->
<div class="admin-wrap" id="adminWrap">
  <!-- SIDEBAR -->
  <aside class="aside" id="aside">
    <div class="aside-logo">
      <h2><svg width="18" height="18" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-flame"/></svg> Банний<span> STEEM</span></h2>
      <small>Адмін панель</small>
    </div>
    <nav class="aside-nav">
      <button class="nav-item active" onclick="showPage('dashboard')"><span class="nav-icon"><svg width="18" height="18" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-chart"/></svg></span>Дашборд</button>
      <button class="nav-item" onclick="showPage('bookings')"><span class="nav-icon"><svg width="18" height="18" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-calendar"/></svg></span>Бронювання</button>
      <button class="nav-item" onclick="showPage('add')"><span class="nav-icon"><svg width="18" height="18" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-plus"/></svg></span>Додати бронь</button>
      <button class="nav-item" onclick="showPage('block')"><span class="nav-icon"><svg width="18" height="18" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-ban"/></svg></span>Блокування</button>
      <button class="nav-item" onclick="showPage('settings')"><span class="nav-icon"><svg width="18" height="18" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-gear"/></svg></span>Налаштування</button>
    </nav>
    <div class="aside-bottom">
      <div style="font-size:11px;color:rgba(255,255,255,0.3);margin-bottom:8px;text-align:center">Адмін: spa_admin</div>
      <a href="index.html" style="display:block;text-align:center;font-size:11px;color:rgba(255,255,255,0.35);text-decoration:none;margin-bottom:8px"><svg width="12" height="12" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-arrow-l"/></svg> Перейти на сайт</a>
      <button class="out-btn" onclick="logout()"><svg width="14" height="14" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-logout"/></svg> Вийти</button>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main-content">

    <!-- DASHBOARD -->
    <div class="page active" id="p-dashboard">
      <div class="topbar">
        <div>
          <h1>Дашборд</h1>
          <div class="tsub" id="todayDate"></div>
        </div>
        <button class="fbtn" onclick="refreshAll()"><svg width="14" height="14" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-refresh"/></svg> Оновити</button>
      </div>
      <div class="stats" id="statsGrid"></div>

      <div class="card">
        <div class="card-head"><h3><svg width="16" height="16" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-calendar"/></svg> Бронювання сьогодні</h3></div>
        <div class="card-body">
          <div class="tbl-wrap"><table id="todayTable">
            <thead><tr><th>#</th><th>Локація</th><th>Час</th><th>Клієнт</th><th>Телефон</th><th>Сума</th><th>Статус</th><th>Дії</th></tr></thead>
            <tbody id="todayBody"></tbody>
          </table></div>
        </div>
      </div>

      <div class="card">
        <div class="card-head"><h3><svg width="16" height="16" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-clock"/></svg> Найближчі бронювання</h3></div>
        <div class="card-body">
          <div class="tbl-wrap"><table>
            <thead><tr><th>#</th><th>Локація</th><th>Дата</th><th>Час</th><th>Клієнт</th><th>Сума</th><th>Статус</th></tr></thead>
            <tbody id="upcomingBody"></tbody>
          </table></div>
        </div>
      </div>
    </div>

    <!-- BOOKINGS -->
    <div class="page" id="p-bookings">
      <div class="topbar">
        <div><h1>Всі бронювання</h1><div class="tsub">Управління та перегляд бронювань</div></div>
      </div>
      <div class="card">
        <div class="card-head">
          <h3>Фільтри</h3>
          <div class="filters">
            <input type="date" class="fin" id="filterDate">
            <select class="fin" id="filterSauna">
              <option value="">Всі бані</option>
              <option>Маленька баня</option>
              <option>Велика баня</option>
              <option>Чан і Хамам</option>
              <option>Чан</option>
              <option>Хамам</option>
            </select>
            <select class="fin" id="filterStatus">
              <option value="">Всі статуси</option>
              <option value="confirmed">Підтверджено</option>
              <option value="cancelled">Скасовано</option>
            </select>
            <button class="fbtn" onclick="renderBookingsTable()">Пошук</button>
            <button class="fbtn outline" onclick="clearFilters()">Скинути</button>
          </div>
        </div>
        <div class="card-body">
          <div class="tbl-wrap"><table>
            <thead><tr><th>ID</th><th>Локація</th><th>Дата</th><th>Час</th><th>Год</th><th>Клієнт</th><th>Телефон</th><th>Сума</th><th>Статус</th><th>Дії</th></tr></thead>
            <tbody id="allBookingsBody"></tbody>
          </table></div>
        </div>
      </div>
    </div>

    <!-- ADD BOOKING -->
    <div class="page" id="p-add">
      <div class="topbar"><div><h1>Додати бронювання</h1><div class="tsub">Ручне створення бронювання</div></div></div>
      <div class="card" style="max-width:600px">
        <div class="card-head"><h3>Нове бронювання</h3></div>
        <div class="card-body">
          <div class="add-row">
          <div class="sfg">
            <label>Локація</label>
            <select id="abSauna">
              <option value="0">Маленька баня (700 грн/год)</option>
              <option value="1">Велика баня (800 грн/год)</option>
              <option value="2">Чан і Хамам (1200 грн/год)</option>
              <option value="3">Великий будинок (добова оренда)</option>
              <option value="4">Маленький будинок (добова оренда)</option>
            </select>
          </div>
            <div class="sfg">
              <label>Дата</label>
              <input type="date" id="abDate">
            </div>
          </div>
          <div class="add-row">
            <div class="sfg">
              <label>Час початку</label>
              <select id="abStart">
                <!-- filled by JS -->
              </select>
            </div>
            <div class="sfg">
              <label>Кількість годин</label>
              <select id="abHours">
                <option value="3">3 год</option>
                <option value="4">4 год</option>
                <option value="5">5 год</option>
                <option value="6">6 год</option>
                <option value="7">7 год</option>
                <option value="8">8 год</option>
              </select>
            </div>
          </div>
          <div class="add-row">
            <div class="sfg">
              <label>Ім'я клієнта</label>
              <input type="text" id="abName" placeholder="Іван Петренко">
            </div>
            <div class="sfg">
              <label>Телефон</label>
              <input type="tel" id="abPhone" placeholder="+38 (073) 000-00-00">
            </div>
          </div>
          <div class="sfg">
            <label>Коментар</label>
            <textarea id="abComment" placeholder="Додаткові примітки..."></textarea>
          </div>
          <div class="sfg">
            <label>Спосіб оплати</label>
            <select id="abPay">
              <option value="cash">Готівка</option>
              <option value="card">Картка</option>
              <option value="sbp">Monobank</option>
            </select>
          </div>
          <div style="background:var(--sky-bg);border-radius:9px;padding:14px;margin:14px 0;font-size:13px;border:1px solid var(--sky-l)">
            <strong><svg width="14" height="14" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-money"/></svg> Попередній розрахунок:</strong> <span id="abTotal">—</span>
          </div>
          <button class="save-btn" onclick="addBooking()"><svg width="14" height="14" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-plus"/></svg> Додати бронювання</button>
        </div>
      </div>
    </div>

    <!-- BLOCK -->
    <div class="page" id="p-block">
      <div class="topbar"><div><h1>Блокування часу</h1><div class="tsub">Закрийте певні години для бронювання</div></div></div>
      <div class="bcal-wrap">
        <div class="mini-cal">
          <div class="mc-nav">
            <button class="mc-arr" onclick="prevBCal()">‹</button>
            <div class="mc-month" id="bcalMonth"></div>
            <button class="mc-arr" onclick="nextBCal()">›</button>
          </div>
          <div class="mc-grid" id="bcalGrid"></div>
        </div>
        <div class="block-slots" id="blockSlotsPanel">
          <h4 id="blockDateTitle">Оберіть дату на календарі</h4>
          <div class="slot-grid" id="blockSlotGrid">
            <div style="color:var(--muted);font-size:13px;grid-column:1/-1">Оберіть дату ліворуч</div>
          </div>
          <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
            <button class="fbtn" onclick="blockAll()" id="blockAllBtn" style="display:none"><svg width="14" height="14" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-ban"/></svg> Заблокувати всі вільні</button>
            <button class="fbtn outline" onclick="unblockAll()" id="unblockAllBtn" style="display:none"><svg width="14" height="14" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-check"/></svg> Розблокувати всі</button>
          </div>
          <div style="margin-top:16px;display:flex;flex-wrap:wrap;gap:12px">
            <div style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)"><div style="width:12px;height:12px;border-radius:3px;border:1.5px solid var(--border)"></div>Вільно</div>
            <div style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)"><div style="width:12px;height:12px;border-radius:3px;background:var(--red-bg);border:1.5px solid var(--red)"></div>Заблоковано</div>
            <div style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)"><div style="width:12px;height:12px;border-radius:3px;background:var(--bg)"></div>Зайнято (брон.)</div>
            <div style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)"><div style="width:12px;height:12px;border-radius:3px;background:var(--yellow-bg)"></div>Прибирання</div>
          </div>
        </div>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="page" id="p-settings">
      <div class="topbar"><div><h1>Налаштування</h1><div class="tsub">Ціни, контакти та загальні параметри</div></div></div>
      <div class="settings-grid">

        <div class="scard">
          <h3><svg width="16" height="16" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-money"/></svg> Ціни (грн/год)</h3>
          <div id="pricesList"></div>
          <button class="save-btn" onclick="savePrices()">Зберегти ціни</button>
        </div>

        <div class="scard">
          <h3><svg width="16" height="16" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-phone"/></svg> Контакти</h3>
          <div class="sfg"><label>Телефон (основний)</label><input type="tel" id="sPhone" placeholder="+38 (073) 000-00-00"></div>
          <div class="sfg"><label>Viber</label><input type="tel" id="sViber" placeholder="+38 (073) 000-00-00"></div>
          <div class="sfg"><label>Telegram (username)</label><input type="text" id="sTG" placeholder="@lisospa"></div>
          <button class="save-btn" onclick="saveContacts()">Зберегти контакти</button>
        </div>

        <div class="scard">
          <h3><svg width="16" height="16" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-pin"/></svg> Загальна інформація</h3>
          <div class="sfg"><label>Назва закладу</label><input type="text" id="sSpaName" placeholder="ЛісоСПА"></div>
          <div class="sfg"><label>Адреса</label><input type="text" id="sSpaAddr" placeholder="с. Лісне, Київська обл."></div>
          <div class="sfg"><label>Час роботи (від)</label><input type="number" id="sWorkFrom" placeholder="8" min="0" max="23"></div>
          <div class="sfg"><label>Час роботи (до)</label><input type="number" id="sWorkTo" placeholder="23" min="0" max="24"></div>
          <div class="sfg"><label>Мінімум годин бронювання</label><input type="number" id="sMinHours" placeholder="3" min="1" max="8"></div>
          <button class="save-btn" onclick="saveGeneral()">Зберегти</button>
        </div>

        <div class="scard">
          <h3><svg width="16" height="16" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-lock"/></svg> Безпека</h3>
          <div class="sfg"><label>Новий пароль адміна</label><input type="password" id="sNewPass" placeholder="Новий пароль"></div>
          <div class="sfg"><label>Підтвердження пароля</label><input type="password" id="sNewPass2" placeholder="Повторіть пароль"></div>
          <button class="save-btn" onclick="changePass()">Змінити пароль</button>
          <hr>
          <h3 style="margin-top:16px"><svg width="16" height="16" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-trash"/></svg> Дані</h3>
          <button class="save-btn" style="background:var(--red);margin-top:10px" onclick="clearOldBookings()">Видалити скасовані бронювання</button>
        </div>

      </div>
    </div>

  </div><!-- main-content -->
</div><!-- admin-wrap -->

<!-- EXTEND MODAL -->
<div class="overlay" id="extOverlay">
  <div class="mbox">
    <button class="mc" onclick="closeExt()">×</button>
    <div class="mtitle">Продовжити бронювання</div>
    <div id="extInfo" style="background:var(--bg);border-radius:9px;padding:14px;margin-bottom:16px;font-size:13px;line-height:1.7"></div>
    <div class="sfg">
      <label>Додати годин</label>
      <select id="extHours">
        <option value="1">1 год</option>
        <option value="2">2 год</option>
        <option value="3">3 год</option>
        <option value="4">4 год</option>
      </select>
    </div>
    <div style="background:var(--yellow-bg);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--yellow);margin-bottom:16px">
      <svg width="14" height="14" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-warn"/></svg> Переконайтесь, що наступні години вільні перед продовженням
    </div>
    <button class="save-btn" onclick="confirmExt()"><svg width="14" height="14" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-check"/></svg> Продовжити</button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
const PASS = 'spa2024';
const SAUNA_NAMES = ['Маленька баня','Велика баня','Чан і Хамам','Великий будинок','Маленький будинок'];
const PRICES_DEF = [700,800,1200,5000,3000];
let bcalYear, bcalMonth, bcalSelDate=null;
let extBookingId=null;

// ===== AUTH =====
function doLogin(){
  const pw = document.getElementById('pwInput').value;
  const stored = localStorage.getItem('spa_admin_pass') || PASS;
  if(pw===stored){
    sessionStorage.setItem('spa_admin_ok','1');
    document.getElementById('loginWrap').style.display='none';
    document.getElementById('adminWrap').style.display='block';
    initAdmin();
  } else {
    document.getElementById('lerr').style.display='block';
    document.getElementById('pwInput').value='';
  }
}
function logout(){sessionStorage.removeItem('spa_admin_ok');location.reload()}
function checkAuth(){
  if(sessionStorage.getItem('spa_admin_ok')==='1'){
    document.getElementById('loginWrap').style.display='none';
    document.getElementById('adminWrap').style.display='block';
    initAdmin();
  }
}

// ===== MOBILE ====
function toggleMobMenu(){document.getElementById('aside').classList.toggle('mob-open')}

// ===== INIT =====
function initAdmin(){
  const now=new Date();
  bcalYear=now.getFullYear();bcalMonth=now.getMonth();
  document.getElementById('todayDate').textContent=now.toLocaleDateString('uk-UA',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  loadSettings();
  renderDashboard();
  renderBCal();
  fillAddForm();
  updateAddTotal();
  document.getElementById('abSauna').addEventListener('change',updateAddTotal);
  document.getElementById('abHours').addEventListener('change',updateAddTotal);
}

function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('p-'+id).classList.add('active');
  event.currentTarget.classList.add('active');
  if(id==='bookings') renderBookingsTable();
  if(id==='dashboard') renderDashboard();
  if(id==='block') renderBCal();
  document.getElementById('aside').classList.remove('mob-open');
}

// ===== BOOKINGS =====
function getBookings(){return JSON.parse(localStorage.getItem('spa_bookings')||'[]')}
function saveBookings(b){localStorage.setItem('spa_bookings',JSON.stringify(b))}

function renderDashboard(){
  const bookings = getBookings();
  const today = fmtD(new Date());
  const todayB = bookings.filter(b=>b.date===today&&b.status!=='cancelled');
  const upcoming = bookings.filter(b=>b.date>today&&b.status!=='cancelled').sort((a,b)=>a.date.localeCompare(b.date)).slice(0,10);
  const totalRevenue = bookings.filter(b=>b.status!=='cancelled').reduce((s,b)=>s+b.total,0);
  const confirmed = bookings.filter(b=>b.status==='confirmed').length;
  const cancelled = bookings.filter(b=>b.status==='cancelled').length;

  document.getElementById('statsGrid').innerHTML = `
    <div class="stat"><div class="stat-icon"><svg width="28" height="28" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-calendar"/></svg></div><div class="stat-val">${todayB.length}</div><div class="stat-label">Сьогодні</div></div>
    <div class="stat"><div class="stat-icon"><svg width="28" height="28" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-check"/></svg></div><div class="stat-val">${confirmed}</div><div class="stat-label">Підтверджено</div></div>
    <div class="stat"><div class="stat-icon"><svg width="28" height="28" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-x"/></svg></div><div class="stat-val">${cancelled}</div><div class="stat-label">Скасовано</div></div>
    <div class="stat"><div class="stat-icon"><svg width="28" height="28" style="display:inline-block;vertical-align:middle;flex-shrink:0"><use href="#ai-money"/></svg></div><div class="stat-val">${totalRevenue.toLocaleString('uk-UA')}</div><div class="stat-label">Грн (разом)</div></div>
  `;

  document.getElementById('todayBody').innerHTML = todayB.length
    ? todayB.map(b=>bookingRow(b,true)).join('')
    : '<tr class="empty-row"><td colspan="8">Сьогодні бронювань немає</td></tr>';

  document.getElementById('upcomingBody').innerHTML = upcoming.length
    ? upcoming.map(b=>`
        <tr>
          <td><span style="font-size:11px;color:var(--muted)">${b.id}</span></td>
          <td>${b.sauna}</td>
          <td><strong>${b.dateDisplay||b.date}</strong></td>
          <td>${b.timeStr}</td>
          <td><div class="td-name">${b.name}</div></td>
          <td><strong>${b.total.toLocaleString('uk-UA')} грн</strong></td>
          <td>${badge(b.status)}</td>
        </tr>`).join('')
    : '<tr class="empty-row"><td colspan="7">Майбутніх бронювань немає</td></tr>';
}

function bookingRow(b, short=false){
  const acts = `
    <div class="act-btns">
      ${b.status==='confirmed'?`<button class="abtn abtn-green" onclick="extendModal('${b.id}')">Продовжити</button>`:''}
      ${b.status==='confirmed'?`<button class="abtn abtn-red" onclick="cancelBook('${b.id}')">Скасувати</button>`:''}
      ${b.status==='cancelled'?`<button class="abtn abtn-sky" onclick="restoreBook('${b.id}')">Відновити</button>`:''}
    </div>`;
  if(short) return `
    <tr>
      <td><span style="font-size:11px;color:var(--muted)">${b.id}</span></td>
      <td>${b.sauna}</td>
      <td>${b.timeStr}</td>
      <td><div class="td-name">${b.name}</div></td>
      <td><div class="td-phone"><a href="tel:${b.phone}">${b.phone}</a></div></td>
      <td><strong>${b.total.toLocaleString('uk-UA')} грн</strong></td>
      <td>${badge(b.status)}</td>
      <td>${acts}</td>
    </tr>`;
  return `
    <tr>
      <td><span style="font-size:11px;color:var(--muted)">${b.id}</span></td>
      <td>${b.sauna}</td>
      <td>${b.dateDisplay||b.date}</td>
      <td>${b.timeStr}</td>
      <td style="text-align:center">${b.hours}</td>
      <td><div class="td-name">${b.name}</div></td>
      <td><div class="td-phone"><a href="tel:${b.phone}">${b.phone}</a></div></td>
      <td><strong>${b.total.toLocaleString('uk-UA')} грн</strong></td>
      <td>${badge(b.status)}</td>
      <td>${acts}</td>
    </tr>`;
}

function badge(s){
  if(s==='confirmed') return '<span class="badge b-conf">Підтверджено</span>';
  if(s==='cancelled') return '<span class="badge b-cancel">Скасовано</span>';
  return '<span class="badge b-pend">Очікує</span>';
}

function cancelBook(id){
  if(!confirm('Скасувати це бронювання?')) return;
  const b=getBookings();const bi=b.findIndex(x=>x.id===id);
  if(bi>-1){b[bi].status='cancelled';saveBookings(b);}
  renderDashboard();renderBookingsTable();showToast('Бронювання скасовано','error');
}
function restoreBook(id){
  const b=getBookings();const bi=b.findIndex(x=>x.id===id);
  if(bi>-1){b[bi].status='confirmed';saveBookings(b);}
  renderDashboard();renderBookingsTable();showToast('Бронювання відновлено','success');
}

function renderBookingsTable(){
  const date=document.getElementById('filterDate').value;
  const sauna=document.getElementById('filterSauna').value;
  const status=document.getElementById('filterStatus').value;
  let b=getBookings();
  if(date) b=b.filter(x=>x.date===date);
  if(sauna) b=b.filter(x=>x.sauna===sauna);
  if(status) b=b.filter(x=>x.status===status);
  b.sort((a,c)=>c.createdAt.localeCompare(a.createdAt));
  document.getElementById('allBookingsBody').innerHTML=b.length
    ? b.map(x=>bookingRow(x)).join('')
    : '<tr class="empty-row"><td colspan="10">Бронювань не знайдено</td></tr>';
}

function clearFilters(){
  document.getElementById('filterDate').value='';
  document.getElementById('filterSauna').value='';
  document.getElementById('filterStatus').value='';
  renderBookingsTable();
}
function refreshAll(){renderDashboard();showToast('Оновлено','success')}

// ===== EXTEND =====
function extendModal(id){
  extBookingId=id;
  const b=getBookings().find(x=>x.id===id);
  document.getElementById('extInfo').innerHTML=`
    <strong>${b.sauna}</strong><br>
    ${b.dateDisplay||b.date} · ${b.timeStr} · ${b.name} (${b.phone})`;
  document.getElementById('extOverlay').classList.add('open');
}
function closeExt(){document.getElementById('extOverlay').classList.remove('open')}
function confirmExt(){
  const addH=parseInt(document.getElementById('extHours').value);
  const b=getBookings();const bi=b.findIndex(x=>x.id===extBookingId);
  if(bi>-1){
    const bk=b[bi];
    const prices=getPrices();
    const newEnd=bk.startH+bk.hours+addH;
    bk.timeStr=`${pad(bk.startH)}:00 – ${pad(newEnd)}:00`;
    bk.hours+=addH;
    bk.total+=prices[bk.saunaIdx||0]*addH;
    saveBookings(b);
  }
  closeExt();renderDashboard();renderBookingsTable();
  showToast(`Продовжено на ${addH} год`,'success');
}

// ===== ADD BOOKING =====
function fillAddForm(){
  const sel=document.getElementById('abStart');
  sel.innerHTML='';
  for(let h=8;h<23;h++){
    const opt=document.createElement('option');
    opt.value=h;opt.textContent=`${pad(h)}:00`;
    sel.appendChild(opt);
  }
  const d=new Date();d.setDate(d.getDate());
  document.getElementById('abDate').valueAsDate=d;
}
function updateAddTotal(){
  const idx=parseInt(document.getElementById('abSauna').value);
  const hrs=parseInt(document.getElementById('abHours').value);
  const prices=getPrices();
  const total=prices[idx]*hrs;
  document.getElementById('abTotal').textContent=`${total.toLocaleString('uk-UA')} грн (${prices[idx]} × ${hrs} год)`;
}
function addBooking(){
  const idx=parseInt(document.getElementById('abSauna').value);
  const date=document.getElementById('abDate').value;
  const startH=parseInt(document.getElementById('abStart').value);
  const hours=parseInt(document.getElementById('abHours').value);
  const name=document.getElementById('abName').value.trim();
  const phone=document.getElementById('abPhone').value.trim();
  if(!date||!name||!phone){showToast('Заповніть всі поля','error');return;}
  const prices=getPrices();
  const booking={
    id:'ADM'+Date.now().toString(36).toUpperCase(),
    sauna:SAUNA_NAMES[idx],saunaIdx:idx,
    date,dateDisplay:new Date(date+'T12:00').toLocaleDateString('uk-UA',{day:'numeric',month:'long',year:'numeric'}),
    startH,hours,
    timeStr:`${pad(startH)}:00 – ${pad(startH+hours)}:00`,
    name,phone,
    comment:document.getElementById('abComment').value.trim(),
    total:prices[idx]*hours,
    status:'confirmed',
    payMethod:document.getElementById('abPay').value,
    createdAt:new Date().toISOString()
  };
  const b=getBookings();b.push(booking);saveBookings(b);
  showToast('Бронювання додано!','success');
  document.getElementById('abName').value='';
  document.getElementById('abPhone').value='';
  document.getElementById('abComment').value='';
}

// ===== BLOCKING =====
function getBlocked(){return JSON.parse(localStorage.getItem('spa_blocked')||'{}')}
function saveBlocked(bl){localStorage.setItem('spa_blocked',JSON.stringify(bl))}

function renderBCal(){
  const months=['Січень','Лютий','Березень','Квітень','Травень','Червень','Липень','Серпень','Вересень','Жовтень','Листопад','Грудень'];
  document.getElementById('bcalMonth').textContent=months[bcalMonth]+' '+bcalYear;
  const grid=document.getElementById('bcalGrid');
  grid.innerHTML='';
  ['ПН','ВТ','СР','ЧТ','ПТ','СБ','НД'].forEach(d=>{
    const el=document.createElement('div');el.className='mcd-l';el.textContent=d;grid.appendChild(el);
  });
  const firstDay=new Date(bcalYear,bcalMonth,1);
  let sw=firstDay.getDay();sw=sw===0?6:sw-1;
  for(let i=0;i<sw;i++){const e=document.createElement('div');e.className='mcd mcd-e';grid.appendChild(e);}
  const days=new Date(bcalYear,bcalMonth+1,0).getDate();
  const today=new Date();today.setHours(0,0,0,0);
  const blocked=getBlocked();
  for(let d=1;d<=days;d++){
    const el=document.createElement('div');el.className='mcd';el.textContent=d;
    const date=new Date(bcalYear,bcalMonth,d);
    const ds=fmtD(date);
    if(date<today){el.classList.add('mcd-p');}
    else{
      if(date.toDateString()===today.toDateString()) el.classList.add('mcd-t');
      if(bcalSelDate&&ds===bcalSelDate) el.classList.add('mcd-s');
      if(blocked[ds]&&blocked[ds].length>0) el.classList.add('has-block');
      el.addEventListener('click',()=>selectBCalDate(ds));
    }
    grid.appendChild(el);
  }
}
function prevBCal(){bcalMonth--;if(bcalMonth<0){bcalMonth=11;bcalYear--;}renderBCal()}
function nextBCal(){bcalMonth++;if(bcalMonth>11){bcalMonth=0;bcalYear++;}renderBCal()}

function selectBCalDate(ds){
  bcalSelDate=ds;
  renderBCal();
  renderBlockSlots(ds);
}

function renderBlockSlots(ds){
  const blocked=getBlocked();
  const bookings=getBookings();
  const bookedH=new Set();
  const cleanH=new Set();
  bookings.filter(b=>b.date===ds&&b.status!=='cancelled').forEach(b=>{
    for(let h=b.startH;h<b.startH+b.hours;h++) bookedH.add(h);
    cleanH.add(b.startH+b.hours);
  });
  const blockedSet=new Set(blocked[ds]||[]);
  const d=new Date(ds+'T12:00');
  document.getElementById('blockDateTitle').textContent=d.toLocaleDateString('uk-UA',{weekday:'long',day:'numeric',month:'long'});
  document.getElementById('blockAllBtn').style.display='inline-block';
  document.getElementById('unblockAllBtn').style.display='inline-block';
  const grid=document.getElementById('blockSlotGrid');
  grid.innerHTML='';
  for(let h=8;h<23;h++){
    const btn=document.createElement('button');
    btn.className='sl-btn';
    btn.textContent=`${pad(h)}:00`;
    if(bookedH.has(h)){btn.classList.add('sl-booked');btn.title='Зайнято бронюванням';}
    else if(cleanH.has(h)){btn.classList.add('sl-cleaning');btn.innerHTML=`${pad(h)} <svg width='11' height='11' style='vertical-align:middle'><use href='#ai-broom'/></svg>`;}
    else if(blockedSet.has(h)){btn.classList.add('sl-blocked');btn.addEventListener('click',()=>toggleBlock(ds,h));}
    else{btn.addEventListener('click',()=>toggleBlock(ds,h));}
    grid.appendChild(btn);
  }
}

function toggleBlock(ds,h){
  const bl=getBlocked();
  if(!bl[ds]) bl[ds]=[];
  const idx=bl[ds].indexOf(h);
  if(idx>-1) bl[ds].splice(idx,1);
  else bl[ds].push(h);
  if(bl[ds].length===0) delete bl[ds];
  saveBlocked(bl);
  renderBCal();
  renderBlockSlots(ds);
}
function blockAll(){
  if(!bcalSelDate) return;
  const bl=getBlocked();
  const bookings=getBookings();
  const bookedH=new Set();
  const cleanH=new Set();
  bookings.filter(b=>b.date===bcalSelDate&&b.status!=='cancelled').forEach(b=>{
    for(let h=b.startH;h<b.startH+b.hours;h++) bookedH.add(h);
    cleanH.add(b.startH+b.hours);
  });
  bl[bcalSelDate]=[];
  for(let h=8;h<23;h++){
    if(!bookedH.has(h)&&!cleanH.has(h)) bl[bcalSelDate].push(h);
  }
  saveBlocked(bl);renderBCal();renderBlockSlots(bcalSelDate);showToast('Всі вільні години заблоковано','error');
}
function unblockAll(){
  if(!bcalSelDate) return;
  const bl=getBlocked();
  delete bl[bcalSelDate];
  saveBlocked(bl);renderBCal();renderBlockSlots(bcalSelDate);showToast('Всі блокування знято','success');
}

// ===== SETTINGS =====
const DEF_SETTINGS={
  prices:[700,800,1200,5000,3000],
  phone:'+38 (098) 545-21-46',viber:'+38 (098) 545-21-46',telegram:'+380985452146',
  name:'Банний комплекс STEEM',addr:'с. Михайлівка-Рубежівка, вул. Житомирська 53',workFrom:0,workTo:24,minHours:3
};
function getSettings(){return JSON.parse(localStorage.getItem('spa_settings')||JSON.stringify(DEF_SETTINGS))}
function saveSettings(s){localStorage.setItem('spa_settings',JSON.stringify(s))}
function getPrices(){return getSettings().prices||PRICES_DEF}

function loadSettings(){
  const s=getSettings();
  // Prices
  const pl=document.getElementById('pricesList');
  pl.innerHTML='';
  SAUNA_NAMES.forEach((n,i)=>{
    const div=document.createElement('div');div.className='price-item';
    div.innerHTML=`<label>${n}</label><input class="price-input" type="number" id="price_${i}" value="${s.prices[i]||PRICES_DEF[i]}" min="100" step="50">`;
    pl.appendChild(div);
  });
  document.getElementById('sPhone').value=s.phone||'';
  document.getElementById('sViber').value=s.viber||'';
  document.getElementById('sTG').value=s.telegram||'';
  document.getElementById('sSpaName').value=s.name||'';
  document.getElementById('sSpaAddr').value=s.addr||'';
  document.getElementById('sWorkFrom').value=s.workFrom||8;
  document.getElementById('sWorkTo').value=s.workTo||23;
  document.getElementById('sMinHours').value=s.minHours||3;
}
function savePrices(){
  const s=getSettings();
  s.prices=SAUNA_NAMES.map((_,i)=>parseInt(document.getElementById('price_'+i).value)||PRICES_DEF[i]);
  saveSettings(s);showToast('Ціни збережено','success');updateAddTotal();
}
function saveContacts(){
  const s=getSettings();
  s.phone=document.getElementById('sPhone').value;
  s.viber=document.getElementById('sViber').value;
  s.telegram=document.getElementById('sTG').value;
  saveSettings(s);showToast('Контакти збережено','success');
}
function saveGeneral(){
  const s=getSettings();
  s.name=document.getElementById('sSpaName').value;
  s.addr=document.getElementById('sSpaAddr').value;
  s.workFrom=parseInt(document.getElementById('sWorkFrom').value);
  s.workTo=parseInt(document.getElementById('sWorkTo').value);
  s.minHours=parseInt(document.getElementById('sMinHours').value);
  saveSettings(s);showToast('Налаштування збережено','success');
}
function changePass(){
  const p1=document.getElementById('sNewPass').value;
  const p2=document.getElementById('sNewPass2').value;
  if(!p1||p1!==p2){showToast('Паролі не збігаються','error');return;}
  if(p1.length<4){showToast('Пароль надто короткий','error');return;}
  localStorage.setItem('spa_admin_pass',p1);
  document.getElementById('sNewPass').value='';document.getElementById('sNewPass2').value='';
  showToast('Пароль змінено','success');
}
function clearOldBookings(){
  if(!confirm('Видалити всі скасовані бронювання? Це незворотньо.')) return;
  const b=getBookings().filter(x=>x.status!=='cancelled');
  saveBookings(b);renderDashboard();renderBookingsTable();
  showToast('Скасовані бронювання видалено','success');
}

// ===== UTILS =====
function fmtD(d){return d.getFullYear()+'-'+pad2(d.getMonth()+1)+'-'+pad2(d.getDate())}
function pad(h){return String(h).padStart(2,'0')}
function pad2(n){return String(n).padStart(2,'0')}
function showToast(msg,type=''){
  const t=document.getElementById('toast');
  t.textContent=msg;t.className='toast '+type+' show';
  setTimeout(()=>t.classList.remove('show'),2800);
}

// ===== START =====
checkAuth();
</script>
</body>
</html>
